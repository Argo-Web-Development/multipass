#!/bin/sh -e

http_proxy="$(snapctl get proxy.http)"
https_proxy="$(snapctl get proxy.https)"
MULTIPASS_VM_DRIVER="$(snapctl get driver)"
export http_proxy
export https_proxy
export MULTIPASS_VM_DRIVER

set -eu

# Re-exec outside of apparmor confinement
if [ -d /sys/kernel/security/apparmor ] && [ "$(cat /proc/self/attr/current)" != "unconfined" ]; then
    exec aa-exec -p unconfined -- "$0" "$@"
fi

# TODO: Need to check if native deb and snap installed??

exec "$SNAP/bin/multipassd" --verbosity debug --logger platform
